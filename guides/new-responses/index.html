<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>New Responses Guide | Curi Documentation</title>
    <link href="https://fonts.googleapis.com/css?family=Zilla+Slab:300,400" rel="stylesheet">
    <link href="/static/css/prism.css" rel="stylesheet">
    <link href="/static/css/index.css" rel="stylesheet">
  </head>
  <body>
    <div id="root"><header><nav><ul><li><a class="home-link " href="/">Curi</a></li><li><a class=" " href="/packages/">Packages</a></li><li><a class=" active" href="/guides/">Guides</a></li><li><a class=" " href="/tutorial/">Tutorials</a></li><li><a class=" " href="/examples/">Examples</a></li><li><a href="https://github.com/pshrmn/curi">GitHub</a></li></ul></nav></header><main tabindex="-1" style="outline:none"><div class="page guide"><div class="content" style="outline:none"><h1>New Responses</h1><div class="explanation"><p>The Curi router uses an observer pattern to call registered functions (called response handlers) when there is a new response. The main function for response handlers is to use the new response to render the application, but any other functionality (like logging) can also be performed.</p></div><div class="section" id="response-handlers"><h3 class="displaced-header"><a class="header-link" href="#response-handlers">Response Handlers</a></h3><div class="explanation"><p>When response handlers are called, they are passed an object with three properties:<!-- --> <a href="/packages/@curi/router/#properties"><code class="inline-code language-javascript">router</code></a>,<!-- --> <a href="/guides/routes-and-responses/#responses"><code class="inline-code language-javascript">response</code></a>, and<!-- --> <a href="/guides/navigation-objects/"><code class="inline-code language-javascript">navigation</code></a>. Which objects/properties you use depends on what the response handler is doing.</p></div><div class="code-block"><pre><code class="language-javascript">function responseHandler({
  router,
  response,
  navigation
}) {
  // ...
}</code></pre></div></div><div class="section" id="registering"><h3 class="displaced-header"><a class="header-link" href="#registering">Registering Response Handlers</a></h3><div class="explanation"><p>There are three ways to attach response handlers to the router:<!-- --> <code class="inline-code language-javascript">router.once()</code> and <code class="inline-code language-javascript">router.observe()</code> or as a side effect.</p><p>Response handlers registered with <code class="inline-code language-javascript">router.once()</code> will only be called one time, while those registered with<!-- --> <code class="inline-code language-javascript">router.observe()</code> and side effects will be called for every new response.</p><p>When you register a response handler using<!-- --> <code class="inline-code language-javascript">router.observe()</code>, it will return a function that you can use to stop calling the response handler for new responses. You should rarely need to do this, but it can be useful for memory management if you are adding and removing lots of observers.</p></div><div class="code-block"><pre><code class="language-javascript">// fn will only be called one time
router.once(fn);

// obs will be called for every new response
const stop = router.observe(fn);</code></pre></div></div><div class="section" id="use-cases"><h3 class="displaced-header"><a class="header-link" href="#use-cases">Use Cases</a></h3><p>What should you use response handlers for?</p><div class="section" id="setup"><h4 class="displaced-header"><a class="header-link" href="#setup">Setup</a></h4><div class="explanation"><p>If any of the routes in an application have <code class="inline-code language-javascript">resolve</code> <!-- -->functions, when they match their responses are created asynchronously. When the application first renders, if the router matches an async route, the response isn&#x27;t immediately ready to use. To deal with this, you can use an observer to render once the initial response is ready.</p><p>A setup function only needs to be called one time, so you can register it with <code class="inline-code language-javascript">router.once()</code>.</p><div class="note"><strong>Note:</strong> <!-- -->In most applications, waiting for the initial response is the only time you may need to write response handlers yourself.</div></div><div class="code-block"><pre><code class="language-jsx">const Router = curiProvider(router);
              
function setup() {
  ReactDOM.render((
    &lt;Router&gt;
      {({ response }) =&gt; &lt;response.body /&gt;}
    &lt;/Router&gt;
  ), document.getElementById(&#x27;root&#x27;));
}

router.once(setup);</code></pre></div></div><div class="section" id="rendering"><h4 class="displaced-header"><a class="header-link" href="#rendering">Rendering</a></h4><div class="explanation"><p>Rendering libraries need to know when there is a new response so that they can re-render the application.</p><p>The Curi rendering packages (<a href="/packages/@curi/react-dom/"><code class="inline-code language-javascript">@curi/react-dom</code></a>,<!-- --> <a href="/packages/@curi/react-native/"><code class="inline-code language-javascript">@curi/react-native</code></a>,<!-- --> <a href="/packages/@curi/vue/"><code class="inline-code language-javascript">@curi/vue</code></a>, and<!-- --> <a href="/packages/@curi/svelte/"><code class="inline-code language-javascript">@curi/svelte</code></a>) setup an observer internally so that they can automatically re-render.</p><p>If you are using vanilla JavaScript to render your application or you are writing your own framework implementation, you would use<!-- --> <code class="inline-code language-javascript">router.observe()</code> to re-render new responses.</p></div><div class="code-block"><pre><code class="language-javascript">function observer({ response }) {
  // let the app know there is a new response
}

router.observe(observer);</code></pre></div></div><div class="section" id="side-effects"><h4 class="displaced-header"><a class="header-link" href="#side-effects">Side Effects</a></h4><div class="explanation"><p>Side effects are observers that are provided to the router at creation instead of by calling <code class="inline-code language-javascript">router.observe()</code>. These can be useful for tasks that are not rendering related as well as for tasks that need to be performed after a render has completed.</p><p>The<!-- --> <a href="/packages/@curi/side-effect-title/"><code class="inline-code language-javascript">@curi/side-effect-title</code></a> <!-- -->package provides a side effect that will use<!-- --> <code class="inline-code language-javascript">response.title</code> to set the page&#x27;s<!-- --> <code class="inline-code language-javascript">document.title</code>.</p><p>With single-page applications, clicking on links wish hashes won&#x27;t always scroll to the matching element in the page. The<!-- --> <a href="/packages/@curi/side-effect-scroll/"><code class="inline-code language-javascript">@curi/side-effect-scroll</code></a> <!-- -->package adds this behavior by scrolling the page to the element that matches the new response&#x27;s hash (<code class="inline-code language-javascript">response.location.hash</code>) after the new response has rendered.</p><p>If you need to add logging to your application, you could write your own observer to do this. Your observer can either be added as a side effect when the router is constructed or later using<!-- --> <code class="inline-code language-javascript">router.observe()</code>.</p></div><div class="code-block"><pre><code class="language-javascript">function logger({ response }) {
  loggingAPI.add(response.location);
}

// as a side-effect
const router = curi(history, routes, {
  sideEffects: [{ fn: logger }]
});

// as an observer
router.observe(logger);</code></pre></div></div></div></div><div class="page-links"><button type="button" class="toggler">Menu</button><div class="children"><h2>Guides</h2><ul class="link-list"><li class="link-group"><div><button title="Toggle group visibility" class="collapse-button"><svg width="25" height="15" viewBox="0 0 25 15" xmlns="http://www.w3.org/2000/svg"><path d="M2,10 l5,-5 l5,5" fill="none" stroke="black" stroke-width="3"></path></svg>basic</button></div><ul class="link-list"><li class="solo"><a class=" " href="/guides/installation/">Installation</a></li><li class="solo"><a class=" " href="/guides/getting-started/">Getting Started</a></li><li class="solo"><a class=" " href="/guides/history/">History</a></li><li class="solo"><a class=" " href="/guides/routes/">Routes</a></li><li class="solo"><a class=" " href="/guides/responses/">Responses</a></li><li class="solo"><a class=" " href="/guides/sync-or-async/">Sync or Async</a></li><li class="solo"><a class=" active" href="/guides/new-responses/">New Responses</a></li></ul></li></ul><ul class="link-list"><li class="link-group"><div><button title="Toggle group visibility" class="collapse-button"><svg width="25" height="15" viewBox="0 0 25 15" xmlns="http://www.w3.org/2000/svg"><path d="M2,10 l5,-5 l5,5" fill="none" stroke="black" stroke-width="3"></path></svg>rendering</button></div><ul class="link-list"><li class="solo"><a class=" " href="/guides/react-dom/">React DOM</a></li><li class="solo"><a class=" " href="/guides/react-native/">React Native</a></li><li class="solo"><a class=" " href="/guides/svelte/">Svelte</a></li><li class="solo"><a class=" " href="/guides/vue/">Vue</a></li></ul></li></ul><ul class="link-list"><li class="link-group"><div><button title="Toggle group visibility" class="collapse-button"><svg width="25" height="15" viewBox="0 0 25 15" xmlns="http://www.w3.org/2000/svg"><path d="M2,10 l5,-5 l5,5" fill="none" stroke="black" stroke-width="3"></path></svg>advanced</button></div><ul class="link-list"><li class="solo"><a class=" " href="/guides/route-interactions/">Route Interactions</a></li><li class="solo"><a class=" " href="/guides/side-effects/">Side Effects</a></li><li class="solo"><a class=" " href="/guides/code-splitting/">Code Splitting</a></li><li class="solo"><a class=" " href="/guides/loading/">Loading Route Data</a></li><li class="solo"><a class=" " href="/guides/ssr/">Server-Side Rendering</a></li><li class="solo"><a class=" " href="/guides/accessibility/">Accessibility</a></li><li class="solo"><a class=" " href="/guides/apollo/">Apollo Integration</a></li><li class="solo"><a class=" " href="/guides/dev-tips/">Development Tips</a></li></ul></li></ul><ul class="link-list"><li class="link-group"><div><button title="Toggle group visibility" class="collapse-button"><svg width="25" height="15" viewBox="0 0 25 15" xmlns="http://www.w3.org/2000/svg"><path d="M2,10 l5,-5 l5,5" fill="none" stroke="black" stroke-width="3"></path></svg>migration</button></div><ul class="link-list"><li class="solo"><a class=" " href="/guides/migrate-rrv3/">React Router v2/3</a></li><li class="solo"><a class=" " href="/guides/migrate-rrv4/">React Router v4</a></li></ul></li></ul></div></div></div></main></div>
    <script src="https://cdn.polyfill.io/v2/polyfill.js?features=Object.assign"></script>
    <script src="https://unpkg.com/react@16.6.0/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@16.6.0/umd/react-dom.production.min.js"></script>
    <script src="/static/js/prism.js"></script>
    <script src="/static/js/bundle.js"></script>
  </body>
</html>
